---
- name: Testing
  hosts: all
  vars:
    PROCESS: Artemis
  
  tasks:
    - name: Check the process status
      shell: jps
      register: output
    - debug:
        var=output
  
  
    - name: Get running processes
      shell: "ps -ef | grep -v grep | grep -w {{ PROCESS }} | awk '{print $2}'"
      register: running_processes
      
    - debug:
        var=running_processes
        
    - name: Kill running processes
      ignore_errors: yes
      shell: "kill {{ item }}"
      with_items: "{{ running_processes.stdout_lines }}"
 
    - wait_for:
        path: "/proc/{{ item }}/status"
        state: absent
      with_items: "{{ running_processes.stdout_lines }}"
      ignore_errors: yes
      register: crunchify_processes
      
    - debug:
        var=crunchify_processes
